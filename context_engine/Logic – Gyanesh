# Context Engine

Owner: Gyanesh

context_engine.py

# SECURION - Context Logic Engine
# Member-2 : Gyanesh
# Role : Risk Engine

import datetime
import time

# -------- GLOBAL ALERT CONTROL --------
COOLDOWN_SECONDS = 30
last_alert_time = 0


def calculate_securion_risk(face_detected, zone, behavior):
    global last_alert_time

    now = datetime.datetime.now()
    hour = now.hour
    current_time = time.time()

    # Night Logic (10 PM â€“ 8 AM)
    is_night = (hour >= 22 or hour < 8)

    risk_score = 0
    details = []

    # ---------------- FACE LOGIC ----------------
    if face_detected:
        risk_score += 50
        details.append("Face Match: YES")

        if is_night:
            risk_score += 20
            details.append(f"Night Access ({now.strftime('%H:%M')})")

        if zone == "RESTRICTED":
            risk_score += 30
            details.append("Restricted Area Entry")

    # ---------------- BEHAVIOR LOGIC ----------------
    if behavior == "LOITERING":
        risk_score += 20
        details.append("Suspicious Loitering")

    elif behavior == "RUNNING":
        risk_score += 30
        details.append("High-Speed Movement")

    # Cap score at 100
    final_score = min(risk_score, 100)

    # ---------------- DECISION ENGINE ----------------
    if final_score >= 70:
        # Cooldown check
        if current_time - last_alert_time > COOLDOWN_SECONDS:
            status = "âš ï¸ ALERT"
            last_alert_time = current_time
        else:
            status = "â³ COOLDOWN ACTIVE (Alert Suppressed)"

    elif final_score >= 50:
        status = "ðŸ”” WARNING"

    else:
        status = "âœ… NORMAL"

    return {
        "Time": now.strftime("%Y-%m-%d %H:%M:%S"),
        "Score": f"{final_score}%",
        "Status": status,
        "Analysis": details
    }


# ---------------- TEST BLOCK ----------------
if __name__ == "__main__":

    print("\n" + "=" * 45)
    print("      SECURION SYSTEM LOG (DAY 16 PRO)     ")
    print("=" * 45)

    result = calculate_securion_risk(True, "RESTRICTED", "LOITERING")

    for key, value in result.items():
        print(f"{key}: {value}")

    print("=" * 45 + "\n")
